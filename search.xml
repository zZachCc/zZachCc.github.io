<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>NAC-802.1/MAC/Portal</title>
    <url>/2022/07/23/NAC-802-1-MAC-Portal/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>AAA之Radius</title>
    <url>/2022/07/23/AAA%E6%A6%82%E8%BF%B0/</url>
    <content><![CDATA[<h1 id="1-AAA"><a href="#1-AAA" class="headerlink" title="1. AAA"></a>1. AAA</h1><h2 id="1-1-什么是AAA？"><a href="#1-1-什么是AAA？" class="headerlink" title="1.1  什么是AAA？"></a>1.1  什么是AAA？</h2><p>AAA是Authentication(认证), Authorization(授权), Accounting(计费)的简称</p>
<p>AAA是一种框架，AAA可以==通过多种协议来实现==最常使用RADIUS（Remote Authentication Dial-In User Service）远程认证拨号用户服务</p>
<h2 id="1-2-AAA的流程"><a href="#1-2-AAA的流程" class="headerlink" title="1.2 AAA的流程"></a>1.2 AAA的流程</h2><p><img src="/2022/07/23/AAA%E6%A6%82%E8%BF%B0/image-20220704172506.png" alt="Pasted image 20220704172506"></p>
<h2 id="1-3-AAA的应用场景"><a href="#1-3-AAA的应用场景" class="headerlink" title="1.3 AAA的应用场景"></a>1.3 AAA的应用场景</h2><ol>
<li> 网络运营商（ISP），需要验证家庭宽带用户的账号密码之后才允许其上网（认证/授权），并记录用户的上网时长/上网流量（计费）</li>
<li> WiFi业务随行，不管用户连接到哪个SSID，都对同一用户提供相同的对待，而对不同用户进行区分对待</li>
<li> 需要认证用户身份的场景（比如VPN）</li>
</ol>
<h2 id="1-4-AAA的组件架构"><a href="#1-4-AAA的组件架构" class="headerlink" title="1.4 AAA的组件架构"></a>1.4 AAA的组件架构</h2><p><img src="/2022/07/23/AAA%E6%A6%82%E8%BF%B0/image-20220704172726.png" alt="image1"></p>
<blockquote>
<p><strong>终端用户(User)</strong><br>其实在AAA中，没有User参与，User通过NAC机制传递用户名/密码给NAS</p>
</blockquote>
<blockquote>
<p><strong>NAS(Network Access Server)(AAA客户端)</strong></p>
<ul>
<li>负责集中收集和管理用户的NAC访问请求</li>
<li>再将用户信息到通过AAA协议传递到指定的AAA服务器</li>
<li>NAS一般为网络设备(接入交换机, AP都可以作为NAS)</li>
</ul>
</blockquote>
<blockquote>
<p><strong>AAA server</strong></p>
<ul>
<li>支持Radius协议(开源协议)的AAA Server有：WinRadius, FreeRadius, SAM</li>
<li>支持TACAS协议(Cisco私有)的AAA Server有：Cisco ACS(Access Control Server)</li>
</ul>
</blockquote>
<hr>
<h1 id="2-Radius"><a href="#2-Radius" class="headerlink" title="2. Radius"></a>2. Radius</h1><h2 id="2-1-RADIUS概述"><a href="#2-1-RADIUS概述" class="headerlink" title="2.1 RADIUS概述"></a>2.1 RADIUS概述</h2><ul>
<li>AAA可以共过多种协议来实现，最常使用的就是RADIUS协议(Remote  Authentication Dial In User Service) (远程用户拨号认证)</li>
<li>该协议可以为Authentication, Authorization, Accounting提供协议层面的完整支持 (相比LDAP就支持不了Accounting)</li>
<li>该协议基于UDP协议，并规定了目的UDP Port 1812为认证授权端口，1813为计费端口</li>
</ul>
<h2 id="2-2-RADIUS中的组件"><a href="#2-2-RADIUS中的组件" class="headerlink" title="2.2 RADIUS中的组件"></a>2.2 RADIUS中的组件</h2><blockquote>
<p><strong>RADIUS客户端</strong><br>一般位于网络接入服务器NAS（Network Access Server）上，可以遍布整个网络，负责传输用户信息到指定的RADIUS服务器，然后根据从服务器返回的信息进行相应处理（如接受/拒绝用户接入)</p>
</blockquote>
<blockquote>
<p><strong>RADIUS服务器</strong></p>
<ul>
<li>一般运行在中心计算机或工作站上，维护相关的用户认证和授权信息</li>
<li>负责接收用户连接请求并认证用户</li>
<li>然后给客户端返回所有需要的信息（如接受/拒绝认证请求）</li>
</ul>
<p>RADIUS服务器通常要维护<strong>三个数据库</strong><br><img src="/2022/07/23/AAA%E6%A6%82%E8%BF%B0/image-20220704144053.png" alt="image3"></p>
<ul>
<li>Users：用于存储用户信息（如用户名、密码以及使用的协议、IP地址等配置信息）。</li>
<li>  Clients：用于存储RADIUS客户端的信息（如共享密钥、IP地址等）。</li>
<li>  Dictionary：用于存储RADIUS协议中的属性和属性值含义的信息。</li>
</ul>
</blockquote>
<h2 id="2-3-RADIUS报文介绍"><a href="#2-3-RADIUS报文介绍" class="headerlink" title="2.3 RADIUS报文介绍"></a>2.3 RADIUS报文介绍</h2><h3 id="2-3-1-RADIUS认证报文类型"><a href="#2-3-1-RADIUS认证报文类型" class="headerlink" title="2.3.1 RADIUS认证报文类型"></a>2.3.1 RADIUS认证报文类型</h3><style> table th: first-of-type { width: 200px; } </style>
<table>
<thead>
<tr>
<th>报文名</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Access-Request</td>
<td>请求报文</td>
<td>认证请求报文，是RADIUS报文交互过程中的第一个报文，用来携带用户的认证信息（例如：用户名、密码等）。认证请求报文由RADIUS客户端发送给RADIUS服务器，RADIUS服务器根据该报文中携带的用户信息判断是否允许接入。</td>
</tr>
<tr>
<td>Access-Accept</td>
<td>相应报文</td>
<td>认证接受报文，是RADIUS服务器对RADIUS客户端发送的Access-Request报文的接受响应报文。如果Access-Request报文中的所有属性都可以接受（即认证通过），则发送该类型报文。RADIUS客户端收到此报文后，用户才能认证通过并被赋予相应的权限。</td>
</tr>
<tr>
<td>Access-Reject</td>
<td>相应报文</td>
<td>认证拒绝报文，是RADIUS服务器对RADIUS客户端的Access-Request报文的拒绝响应报文。如果Access-Request报文中的任何一个属性不可接受（即认证失败），则RADIUS服务器返回Access-Reject报文，用户认证失败。</td>
</tr>
<tr>
<td>Access-Challenge</td>
<td>相应报文</td>
<td>认证挑战报文。EAP中继认证时，RADIUS服务器接收到Access-Request报文中携带的用户名信息后，会随机生成一个MD5挑战字，同时将此挑战字通过Access-Challenge报文发送给用户。用户使用该挑战字对用户密码进行加密处理后，将新的用户密码信息通过Access-Request报文发送给RADIUS服务器。RADIUS服务器将收到的已加密的密码信息和本地经过加密运算后的密码信息进行对比，如果相同，则该用户为合法用户。</td>
</tr>
</tbody></table>
<h3 id="2-3-2-RADIUS报文结构"><a href="#2-3-2-RADIUS报文结构" class="headerlink" title="2.3.2 RADIUS报文结构"></a>2.3.2 RADIUS报文结构</h3><p>RADIUS协议是基于UDP协议的，RADIUS报文格式如下所示</p>
<p><img src="/2022/07/23/AAA%E6%A6%82%E8%BF%B0/image-20220704145004.png" alt="image4"></p>
<blockquote>
<p>Attribute字段详述: <a href="https://support.huawei.com/enterprise/zh/doc/EDOC1100242379/5a06b3ea#ZH-CN_CONCEPT_0176366146">Redius属性</a>.</p>
</blockquote>
<h2 id="2-4-RADIUS认证流程"><a href="#2-4-RADIUS认证流程" class="headerlink" title="2.4 RADIUS认证流程"></a>2.4 RADIUS认证流程</h2><ol>
<li><p> 当用户接入网络时，通过NAC机制，RADIUS客户端（即设备）可以获得想要接入网络的用户的 ‘用户名和密码’。</p>
</li>
<li><p>RADIUS客户端向RADIUS服务器发送 Access-Request 报文（包含用户名和密码信息）</p>
</li>
<li><p>RADIUS服务器对用户身份的合法性进行检验：</p>
<ul>
<li>如果用户身份合法，RADIUS服务器向RADIUS客户端返回Access-Accept报文</li>
<li>如果用户身份不合法，RADIUS服务器向RADIUS客户端返回Access-Reject报文</li>
</ul>
</li>
<li><p>RADIUS客户端，通过NAC机制，通知用户认证是否成功。</p>
</li>
</ol>
<h2 id="2-5-RADIUS客户端可支持的功能"><a href="#2-5-RADIUS客户端可支持的功能" class="headerlink" title="2.5 RADIUS客户端可支持的功能"></a>2.5 RADIUS客户端可支持的功能</h2><h3 id="2-5-1-可配置RADIUS报文重传机制"><a href="#2-5-1-可配置RADIUS报文重传机制" class="headerlink" title="2.5.1 可配置RADIUS报文重传机制"></a>2.5.1 可配置RADIUS报文重传机制</h3><ul>
<li>为避免由于网络故障、时延等原因导致RADIUS客户端无法收到RADIUS服务器的回应报文，可以在RADIUS客户端(NAS)可以配置RADIUS重传机制</li>
<li>报文重传机制有两个参数：<ul>
<li>重传间隔时间：一般默认值2s</li>
<li>最大重传次数：一般默认值5times</li>
</ul>
</li>
</ul>
<p>重传机制规则：</p>
<ol>
<li>如果达到重传间隔时间，RADIUS客户端未收到RADIUS服务器的响应报文，会再次发送认证请求报文</li>
<li>达到最大重传次数后，RADIUS客户端会停止重传</li>
</ol>
<h3 id="2-5-2-可配置RADIUS服务器选择机制"><a href="#2-5-2-可配置RADIUS服务器选择机制" class="headerlink" title="2.5.2 可配置RADIUS服务器选择机制"></a>2.5.2 可配置RADIUS服务器选择机制</h3><p>当网络中存在多台Radius服务器时，RADIUS客户端可以配置其下一种RADIUS服务器选择机制：</p>
<ul>
<li>RADIUS服务器主备算法</li>
<li>RADIUS服务器负载均衡算法</li>
</ul>
<blockquote>
<p><strong>RADIUS服务器主备算法</strong><br>主备算法根据配置RADIUS认证服务器的权重决定，优先向权重高服务器发送认证请求报文，如果此服务器没有回应，则向权重低的服务器发送认证请求报文</p>
</blockquote>
<blockquote>
<p><strong>RADIUS服务器负载均衡算法</strong><br>负载均衡算法根据RADIUS认证服务器的权重来分配认证请求报文发往的概率<br>E.g. RADIUS服务器1的权重为80，RADIUS服务器2的权重为20，认证请求报文发往1的概率为80%</p>
</blockquote>
<h3 id="2-5-3-可配置RADIUS-CoA-DM-功能"><a href="#2-5-3-可配置RADIUS-CoA-DM-功能" class="headerlink" title="2.5.3 可配置RADIUS CoA/DM 功能"></a>2.5.3 可配置RADIUS CoA/DM 功能</h3><p>CoA和DM是由==RADIUS服务端主动发起的请求==，需要RADIUS客户端开启此功能才能生效</p>
<blockquote>
<p><strong>Redius CoA</strong><br>CoA（Change of Authorization）是指用户认证成功后，Redius可以通过RADIUS协议来修改在线用户的权限或对其进行重认证</p>
<p><strong>Redius CoA的报文交互流程</strong><br><img src="/2022/07/23/AAA%E6%A6%82%E8%BF%B0/image-20220704165357.png" alt="image6"></p>
<ol>
<li> RADIUS服务器根据业务信息，向设备发送CoA-Request报文，请求更改用户的授权信息。该报文中可以包括ACL规则等授权信息。</li>
<li> 设备收到CoA-Request报文后，与设备上的用户信息匹配来识别用户。如果匹配成功，则更改用户的授权信息；如果匹配失败，则保持用户原有授权信息。</li>
<li>设备回应CoA-ACK/NAK报文。<pre><code>-   如果更改成功，则设备向RADIUS服务器回应CoA-ACK报文。
-   如果更改失败，则设备向RADIUS服务器回应CoA-NAK报文。
</code></pre>
</li>
</ol>
</blockquote>
<blockquote>
<p><strong>Redius DM</strong><br>DM（Disconnect Message）是指用户下线报文，即由RADIUS服务器主动发起的强制用户下线的报文</p>
<p><strong>Redius DM的报文交互流程</strong></p>
<blockquote>
<p><img src="/2022/07/23/AAA%E6%A6%82%E8%BF%B0/image-20220704165757.png" alt="image7"></p>
</blockquote>
<ol>
<li> 管理员在RADIUS服务器上强制用户下线，RADIUS服务器向设备发送DM-Request报文，请求用户下线。</li>
<li> 设备收到DM-Request报文后，与设备上的用户信息匹配来识别用户。如果匹配成功，则通知用户下线；如果匹配失败，则用户保持在线。</li>
<li>设备回应DM-ACK/NAK报文。<pre><code>-   如果用户成功下线，设备给RADIUS服务器回应DM-ACK报文。
-   如果用户未下线，设备给RADIUS服务器回应DM-NAK报文。
</code></pre>
</li>
</ol>
</blockquote>
]]></content>
      <categories>
        <category>Networking</category>
      </categories>
  </entry>
</search>
