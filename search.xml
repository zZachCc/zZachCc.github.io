<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>NAC-802.1/MAC/Portal</title>
    <url>/2022/07/23/NAC-802-1-MAC-Portal/</url>
    <content><![CDATA[<h1 id="1-NAC"><a href="#1-NAC" class="headerlink" title="1. NAC"></a>1. NAC</h1><p><strong>什么是NAC？</strong></p>
<blockquote>
<p>NAC（Network Access Control）称为<strong>网络接入控制</strong>，通过对接入网络的客户端和用户的认证保证网络的安全，是一种“端到端”的安全技术。</p>
</blockquote>
<p><strong>NAC场景的基本结构</strong></p>
<blockquote>
<p>终端(接入者) —– NAS(接入设备.eg. switch/AP) —– AAA服务器</p>
</blockquote>
<p><strong>NAC和AAA是什么关系？</strong></p>
<table>
<thead>
<tr>
<th align="left">NAC</th>
<th align="left">AAA</th>
</tr>
</thead>
<tbody><tr>
<td align="left">用于终端和接入设备之间的交互</td>
<td align="left">用于接入设备与认证服务器之间的交互</td>
</tr>
<tr>
<td align="left">终端通过NAC机制传递用户名/密码给接入设备</td>
<td align="left">接入设备通过AAA来认证用户</td>
</tr>
</tbody></table>
<blockquote>
<p>Cc白话：NAC用来收集终端用户的信息，AAA用来认证、授权这个用户</p>
</blockquote>
<p><strong>NAC的三种方式</strong></p>
<table>
<thead>
<tr>
<th align="left"><strong>对比项</strong></th>
<th align="left"><strong>802.1X认证</strong></th>
<th align="left"><strong>MAC认证</strong></th>
<th align="left"><strong>Portal认证</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><div style="width: 50pt">终端需求</div></td>
<td align="left">终端需安装客户端</td>
<td align="left">终端无需安装客户端</td>
<td align="left">终端无需安装客户端</td>
</tr>
<tr>
<td align="left">适用场景</td>
<td align="left">新建网络、用户固定、信息安全要求严格的场景</td>
<td align="left">哑终端(打印机、IP电话等)需要接入认证的场景</td>
<td align="left">用户分散、用户流动性大的场景</td>
</tr>
</tbody></table>
<hr>
<h1 id="2-802-1X认证"><a href="#2-802-1X认证" class="headerlink" title="2. 802.1X认证"></a>2. 802.1X认证</h1><h2 id="2-1-802-1X认证简介"><a href="#2-1-802-1X认证简介" class="headerlink" title="2.1 802.1X认证简介"></a>2.1 802.1X认证简介</h2><p><strong>定义</strong></p>
<blockquote>
<p>802.1X协议是一种“基于端口的网络接入控制协议”，所以802.1X是在“接口”上配置生效的(物理接口/虚拟接口)</p>
</blockquote>
<p><strong>802.1X认证场景的基本结构</strong></p>
<blockquote>
<p>和基本NAC的场景结构一致: 客户端/接入设备/认证服务器<br><img src="/2022/07/23/NAC-802-1-MAC-Portal/image-220220724205635.png" alt="image1"></p>
<ul>
<li>客户端：是指终端设备上的支持的802.1X软件，用户可以通过启动客户端软件发起802.1X认证</li>
<li>接入设备：通常为支持802.1X协议的网络设备，它为客户端提供接入局域网的端口，该端口可以是物理端口，也可以是逻辑端口</li>
<li>认证服务器：用于实现对用户进行认证、授权和计费，通常为RADIUS服务器</li>
</ul>
</blockquote>
<hr>
<h2 id="2-2-802-1X认证所需的协议"><a href="#2-2-802-1X认证所需的协议" class="headerlink" title="2.2 802.1X认证所需的协议"></a>2.2 802.1X认证所需的协议</h2><p>802.1X认证需要在客户端与接入设备之间交互用户的信息，这些信息是通过什么协议交互的？</p>
<blockquote>
<p>EAP (Extensible Authentication Protocol)</p>
</blockquote>
<p>EAP早期是为PPP协议设计的一款协议，无法在Ethernet上传输，怎么办？</p>
<blockquote>
<p>EAPoL(EAP over LANs)， 在EAP报文外面再封装一层EAPoL，EAPoL外面直接封装Ethernet帧头，不需要封装IP协议，因为802.1X协议是一个纯二层协议</p>
</blockquote>
<h3 id="2-2-1-EAP报文结构"><a href="#2-2-1-EAP报文结构" class="headerlink" title="2.2.1 EAP报文结构"></a>2.2.1 EAP报文结构</h3><p><img src="/2022/07/23/NAC-802-1-MAC-Portal/image-220220724210811.png" alt="image2"></p>
<table>
<thead>
<tr>
<th align="left">字段</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Code</td>
<td align="left">表示EAP数据包的类型: <br> 1:Request <br> 2:Response <br> 3:Success <br> 4:Failure</td>
</tr>
<tr>
<td align="left">ID</td>
<td align="left">用于对应一个Request和它的Response</td>
</tr>
<tr>
<td align="left">Length</td>
<td align="left">表示EAP数据包的长度，包括Code、ID、Length以及Data各字段的总长度</td>
</tr>
<tr>
<td align="left">Data</td>
<td align="left">Data字段的格式由Code的值来决定<br>- 当Code字段为1或2时，EAP为Request和Response报文，Data包含Type, Type Data两个字段。Type表示Request/Response的类型；Type Data为类型所包含的内容<br>- 当Code取值为3或者4时，EAP为Success和Failure报文，没有Data字段。</td>
</tr>
</tbody></table>
<p>Code为1时，报文类型是EAP-Request；Code为2时，报文类型是EAP-Response。这两类<br>报文是有负载的，也就是Data字段，Data字段中的内容如下：</p>
<table>
<thead>
<tr>
<th align="left">Type字段值</th>
<th align="left">类型</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><div style="width: 50pt">1</div></td>
<td align="left"><div style="width: 60pt">Identity</div></td>
<td align="left"><div style="width: 300pt">携带用户的用户名信息</div></td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">Notification</td>
<td align="left">非必须的通知消息，传送一些警告消息，例如密码已过期、账号被锁等。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">NAK</td>
<td align="left">仅用于Response帧，表示否定确认。例如终端使用了接入设备不支持的认证方法发起请求，客户端可利用Response/NAK报文以告知终端其支持的认证方法</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">MD5-Challenge</td>
<td align="left">携带用户的密码信息(MD5哈希加密)</td>
</tr>
</tbody></table>
<h3 id="2-2-2-EAPoL"><a href="#2-2-2-EAPoL" class="headerlink" title="2.2.2 EAPoL"></a>2.2.2 EAPoL</h3><p>EAPoL是802.1X协议定义的一种报文封装格式，使EAP可以在LAN上进行传输。</p>
<p><img src="/2022/07/23/NAC-802-1-MAC-Portal/image-220220724214829.png" alt="image3"></p>
<table>
<thead>
<tr>
<th align="left">字段</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">PAE Ethernet Type</td>
<td align="left">表示协议类型，值为0x888E。</td>
</tr>
<tr>
<td align="left">Protocol Version</td>
<td align="left">表示EAPoL帧的发送方所支持的802.1X协议版本号</td>
</tr>
<tr>
<td align="left">Type</td>
<td align="left">表示EAPoL数据帧类型:<br>00：EAP-Packet，用于封装EAP报文(EAP在负载里面)<br>01：EAPoL-Start，用于用户主动发起认证过程<br>02：EAPoL-Logoff，用于用户主动发起下线请求<br>03：EAPoL-Key，密钥信息报文。</td>
</tr>
<tr>
<td align="left">Length</td>
<td align="left">表示负载的长度，也就是Packet Body字段的长度，EAPoL-Start和EAPoL-Logoff报文的Length值都为0</td>
</tr>
<tr>
<td align="left">Packet Body</td>
<td align="left">当EAPoL type为00时，EAP报文就封装在这里</td>
</tr>
</tbody></table>
<h2 id="2-3-802-1X认证流程"><a href="#2-3-802-1X认证流程" class="headerlink" title="2.3 802.1X认证流程"></a>2.3 802.1X认证流程</h2><p><strong>802.1X怎么触发？</strong></p>
<blockquote>
<p>802.1X认证有以下触发方式：</p>
<ul>
<li>  终端主动发送EAPoL-Start报文给接入设备，触发认证。</li>
<li>  终端关联至接入设备时，接入设备触发认证。(唯一的差别就是，没有下述流程中的第一步)</li>
</ul>
</blockquote>
<p><strong>802.1X认证方式</strong></p>
<blockquote>
<p><strong>1. 中继方式</strong></p>
<ul>
<li>中继方式中，接入设备将EAP-Response/Identity和EAP-Response/MD5Challenge这两个报文直接通过Radius的Access-Request报文透传给Radius服务器</li>
<li>Radius服务器以EAP的方式验证用户信息</li>
</ul>
</blockquote>
<blockquote>
<p><strong>2. 终结方式</strong></p>
<ul>
<li>终结方式中，接入设备将EAP-Response/Identity和EAP-Response/MD5Challenge这两个报文中的用户信息提取出来，再用Radius报文把用户信息封装到Access-Request报文发送给Radius服务器</li>
<li>Radius服务器以PAP或CHAP的方式验证用户信息</li>
</ul>
</blockquote>
<p><strong>802.1X认证流程</strong></p>
<blockquote>
<p><strong>EAP中继方式</strong><br><img src="/2022/07/23/NAC-802-1-MAC-Portal/image-220220724223847.png" alt="image4"><br>(1) 终端向接人设备发送一个EAPoL-Start报文，开始802.1x认证接入；<br>(2) 接入设备向终端发送EAP-Request/Identity 报文，要求客户端将用户名发过来；<br>(3) 终端回应一个EAP-Response/Identity 给接入设备，其中包括用户名；<br>(4) 接入设备将EAP-Response/Identity 报文封装到RADIUS的Access-Request 报文中，发送给认证服务器；<br>(5) 认证服务器产生一个EAP-Request/MD5-Challenge报文，封装到RADIUS的Access-Challenge 报文中，发送给接入设备；<br>(6) 接入设备拆掉Radius封装，把EAP-Request/MD5-Challenge 发送给终端，要求终端进行认证；<br>(7) 终端收到EAP-Request/MD5-Challenge报文后，对“用户密码+Challenge”做MD5算法生成Challenged-Password，将Challenged-Password封装到EAP-Response/MD5-Challenge 回应给接入设备；<br>(8) 接入设备将EAP-Response/MD5-Challenge封装到Radius的Access-Request 报文中，发送给认证服务器；<br>(9) 认证服务器现在拥有了终端的用户名以及密码，采用EAP的方式认证用户；<br>(10) 认证服务器生成EAP-Success报文，封装到Radius的Access-Accept 报文中，发送给接入设备；<br>(11) 接入设备拆掉Radius封装，把EAP-Success报文发送给终端，并将端口改为授权状态。<br>(12) 终端可以发送EAPoL-Logoff报文给接入设备，主动要求下线；<br>(13) 接入设备把端口状态从授权状态改变成未授权状态，并向客户端发送EAP-Failure报文。</p>
</blockquote>
<blockquote>
<p><strong>EAP终结方式</strong><br><img src="/2022/07/23/NAC-802-1-MAC-Portal/image-220220724224025.png" alt="image6"><br>(1) 终端向接人设备发送一个EAPoL-Start报文，开始802.1x认证接入；<br>(2) 接入设备向终端发送EAP-Request/Identity 报文，要求客户端将用户名发过来；<br>(3) 终端回应一个EAP-Response/Identity 给接入设备，其中包括用户名；<br>(4) 接入设备产生一个EAP-Request/MD5-Challenge报文，发送给终端；<br>(5) 终端收到EAP-Request/MD5-Challenge报文后，对“用户密码+Challenge”做MD5算法生成Challenged-Password，将Challenged-Password封装到EAP-Response/MD5-Challenge 回应给接入设备；<br>(6) 接入设备提取出用户名和密码，将其封装到Radius的Access-Request 报文中(PAP或CHAP方式)，发送给认证服务器；<br>(7) 认证服务器现在拥有了终端的用户名以及密码，采用PAP或CHAP的方式认证用户，如成功，认证服务器生成EAP-Success报文，封装到Radius的Access-Accept 报文中，发送给接入设备；<br>(8) 接入设备拆掉Radius封装，把EAP-Success报文发送给终端，并将端口改为授权状态。<br>(9) 终端可以发送EAPoL-Logoff报文给接入设备，主动要求下线；<br>(10) 接入设备把端口状态从授权状态改变成未授权状态，并向客户端发送EAP-Failure报文。</p>
</blockquote>
<hr>
<h1 id="3-MAC认证"><a href="#3-MAC认证" class="headerlink" title="3. MAC认证"></a>3. MAC认证</h1><h1 id="4-MAC认证"><a href="#4-MAC认证" class="headerlink" title="4. MAC认证"></a>4. MAC认证</h1>]]></content>
      <categories>
        <category>Networking</category>
      </categories>
  </entry>
  <entry>
    <title>AAA之Radius</title>
    <url>/2022/07/23/AAA%E6%A6%82%E8%BF%B0/</url>
    <content><![CDATA[<h1 id="1-AAA"><a href="#1-AAA" class="headerlink" title="1. AAA"></a>1. AAA</h1><h2 id="1-1-什么是AAA？"><a href="#1-1-什么是AAA？" class="headerlink" title="1.1  什么是AAA？"></a>1.1  什么是AAA？</h2><p>AAA是Authentication(认证), Authorization(授权), Accounting(计费)的简称</p>
<p>AAA是一种框架，AAA可以==通过多种协议来实现==最常使用RADIUS（Remote Authentication Dial-In User Service）远程认证拨号用户服务</p>
<h2 id="1-2-AAA的流程"><a href="#1-2-AAA的流程" class="headerlink" title="1.2 AAA的流程"></a>1.2 AAA的流程</h2><p><img src="/2022/07/23/AAA%E6%A6%82%E8%BF%B0/image-20220704172506.png" alt="Pasted image 20220704172506"></p>
<h2 id="1-3-AAA的应用场景"><a href="#1-3-AAA的应用场景" class="headerlink" title="1.3 AAA的应用场景"></a>1.3 AAA的应用场景</h2><ol>
<li> 网络运营商（ISP），需要验证家庭宽带用户的账号密码之后才允许其上网（认证/授权），并记录用户的上网时长/上网流量（计费）</li>
<li> WiFi业务随行，不管用户连接到哪个SSID，都对同一用户提供相同的对待，而对不同用户进行区分对待</li>
<li> 需要认证用户身份的场景（比如VPN）</li>
</ol>
<h2 id="1-4-AAA的组件架构"><a href="#1-4-AAA的组件架构" class="headerlink" title="1.4 AAA的组件架构"></a>1.4 AAA的组件架构</h2><p><img src="/2022/07/23/AAA%E6%A6%82%E8%BF%B0/image-20220704172726.png" alt="image1"></p>
<blockquote>
<p><strong>终端用户(User)</strong><br>其实在AAA中，没有User参与，User通过NAC机制传递用户名/密码给NAS</p>
</blockquote>
<blockquote>
<p><strong>NAS(Network Access Server)(AAA客户端)</strong></p>
<ul>
<li>负责集中收集和管理用户的NAC访问请求</li>
<li>再将用户信息到通过AAA协议传递到指定的AAA服务器</li>
<li>NAS一般为网络设备(接入交换机, AP都可以作为NAS)</li>
</ul>
</blockquote>
<blockquote>
<p><strong>AAA server</strong></p>
<ul>
<li>支持Radius协议(开源协议)的AAA Server有：WinRadius, FreeRadius, SAM</li>
<li>支持TACAS协议(Cisco私有)的AAA Server有：Cisco ACS(Access Control Server)</li>
</ul>
</blockquote>
<hr>
<h1 id="2-Radius"><a href="#2-Radius" class="headerlink" title="2. Radius"></a>2. Radius</h1><h2 id="2-1-RADIUS概述"><a href="#2-1-RADIUS概述" class="headerlink" title="2.1 RADIUS概述"></a>2.1 RADIUS概述</h2><ul>
<li>AAA可以共过多种协议来实现，最常使用的就是RADIUS协议(Remote  Authentication Dial In User Service) (远程用户拨号认证)</li>
<li>该协议可以为Authentication, Authorization, Accounting提供协议层面的完整支持 (相比LDAP就支持不了Accounting)</li>
<li>该协议基于UDP协议，并规定了目的UDP Port 1812为认证授权端口，1813为计费端口</li>
</ul>
<h2 id="2-2-RADIUS中的组件"><a href="#2-2-RADIUS中的组件" class="headerlink" title="2.2 RADIUS中的组件"></a>2.2 RADIUS中的组件</h2><blockquote>
<p><strong>RADIUS客户端</strong><br>一般位于网络接入服务器NAS（Network Access Server）上，可以遍布整个网络，负责传输用户信息到指定的RADIUS服务器，然后根据从服务器返回的信息进行相应处理（如接受/拒绝用户接入)</p>
</blockquote>
<blockquote>
<p><strong>RADIUS服务器</strong></p>
<ul>
<li>一般运行在中心计算机或工作站上，维护相关的用户认证和授权信息</li>
<li>负责接收用户连接请求并认证用户</li>
<li>然后给客户端返回所有需要的信息（如接受/拒绝认证请求）</li>
</ul>
<p>RADIUS服务器通常要维护<strong>三个数据库</strong><br><img src="/2022/07/23/AAA%E6%A6%82%E8%BF%B0/image-20220704144053.png" alt="image3"></p>
<ul>
<li>Users：用于存储用户信息（如用户名、密码以及使用的协议、IP地址等配置信息）。</li>
<li>  Clients：用于存储RADIUS客户端的信息（如共享密钥、IP地址等）。</li>
<li>  Dictionary：用于存储RADIUS协议中的属性和属性值含义的信息。</li>
</ul>
</blockquote>
<h2 id="2-3-RADIUS报文介绍"><a href="#2-3-RADIUS报文介绍" class="headerlink" title="2.3 RADIUS报文介绍"></a>2.3 RADIUS报文介绍</h2><h3 id="2-3-1-RADIUS认证报文类型"><a href="#2-3-1-RADIUS认证报文类型" class="headerlink" title="2.3.1 RADIUS认证报文类型"></a>2.3.1 RADIUS认证报文类型</h3><table>
<thead>
<tr>
<th>报文名</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><div style="width: 110pt">Access-Request</div></td>
<td><div style="width: 60pt">请求报文</div></td>
<td>认证请求报文，是RADIUS报文交互过程中的第一个报文，用来携带用户的认证信息（例如：用户名、密码等）。认证请求报文由RADIUS客户端发送给RADIUS服务器，RADIUS服务器根据该报文中携带的用户信息判断是否允许接入。</td>
</tr>
<tr>
<td>Access-Accept</td>
<td>响应报文</td>
<td>认证接受报文，是RADIUS服务器对RADIUS客户端发送的Access-Request报文的接受响应报文。如果Access-Request报文中的所有属性都可以接受（即认证通过），则发送该类型报文。RADIUS客户端收到此报文后，用户才能认证通过并被赋予相应的权限。</td>
</tr>
<tr>
<td>Access-Reject</td>
<td>响应报文</td>
<td>认证拒绝报文，是RADIUS服务器对RADIUS客户端的Access-Request报文的拒绝响应报文。如果Access-Request报文中的任何一个属性不可接受（即认证失败），则RADIUS服务器返回Access-Reject报文，用户认证失败。</td>
</tr>
<tr>
<td>Access-Challenge</td>
<td>响应报文</td>
<td>认证挑战报文。EAP中继认证时，RADIUS服务器接收到Access-Request报文中携带的用户名信息后，会随机生成一个MD5挑战字，同时将此挑战字通过Access-Challenge报文发送给用户。用户使用该挑战字对用户密码进行加密处理后，将新的用户密码信息通过Access-Request报文发送给RADIUS服务器。RADIUS服务器将收到的已加密的密码信息和本地经过加密运算后的密码信息进行对比，如果相同，则该用户为合法用户。</td>
</tr>
</tbody></table>
<h3 id="2-3-2-RADIUS报文结构"><a href="#2-3-2-RADIUS报文结构" class="headerlink" title="2.3.2 RADIUS报文结构"></a>2.3.2 RADIUS报文结构</h3><p>RADIUS协议是基于UDP协议的，RADIUS报文格式如下所示</p>
<p><img src="/2022/07/23/AAA%E6%A6%82%E8%BF%B0/image-20220704145004.png" alt="image4"></p>
<blockquote>
<p>Attribute字段详述: <a href="https://support.huawei.com/enterprise/zh/doc/EDOC1100242379/5a06b3ea#ZH-CN_CONCEPT_0176366146">Redius属性</a>.</p>
</blockquote>
<h2 id="2-4-RADIUS认证流程"><a href="#2-4-RADIUS认证流程" class="headerlink" title="2.4 RADIUS认证流程"></a>2.4 RADIUS认证流程</h2><ol>
<li><p> 当用户接入网络时，通过NAC机制，RADIUS客户端（即设备）可以获得想要接入网络的用户的 ‘用户名和密码’。</p>
</li>
<li><p>RADIUS客户端向RADIUS服务器发送 Access-Request 报文（包含用户名和密码信息）</p>
</li>
<li><p>RADIUS服务器对用户身份的合法性进行检验：</p>
<ul>
<li>如果用户身份合法，RADIUS服务器向RADIUS客户端返回Access-Accept报文</li>
<li>如果用户身份不合法，RADIUS服务器向RADIUS客户端返回Access-Reject报文</li>
</ul>
</li>
<li><p>RADIUS客户端，通过NAC机制，通知用户认证是否成功。</p>
</li>
</ol>
<h2 id="2-5-RADIUS客户端可支持的功能"><a href="#2-5-RADIUS客户端可支持的功能" class="headerlink" title="2.5 RADIUS客户端可支持的功能"></a>2.5 RADIUS客户端可支持的功能</h2><h3 id="2-5-1-可配置RADIUS报文重传机制"><a href="#2-5-1-可配置RADIUS报文重传机制" class="headerlink" title="2.5.1 可配置RADIUS报文重传机制"></a>2.5.1 可配置RADIUS报文重传机制</h3><ul>
<li>为避免由于网络故障、时延等原因导致RADIUS客户端无法收到RADIUS服务器的回应报文，可以在RADIUS客户端(NAS)可以配置RADIUS重传机制</li>
<li>报文重传机制有两个参数：<ul>
<li>重传间隔时间：一般默认值2s</li>
<li>最大重传次数：一般默认值5times</li>
</ul>
</li>
</ul>
<p>重传机制规则：</p>
<ol>
<li>如果达到重传间隔时间，RADIUS客户端未收到RADIUS服务器的响应报文，会再次发送认证请求报文</li>
<li>达到最大重传次数后，RADIUS客户端会停止重传</li>
</ol>
<h3 id="2-5-2-可配置RADIUS服务器选择机制"><a href="#2-5-2-可配置RADIUS服务器选择机制" class="headerlink" title="2.5.2 可配置RADIUS服务器选择机制"></a>2.5.2 可配置RADIUS服务器选择机制</h3><p>当网络中存在多台Radius服务器时，RADIUS客户端可以配置其下一种RADIUS服务器选择机制：</p>
<ul>
<li>RADIUS服务器主备算法</li>
<li>RADIUS服务器负载均衡算法</li>
</ul>
<blockquote>
<p><strong>RADIUS服务器主备算法</strong><br>主备算法根据配置RADIUS认证服务器的权重决定，优先向权重高服务器发送认证请求报文，如果此服务器没有回应，则向权重低的服务器发送认证请求报文</p>
</blockquote>
<blockquote>
<p><strong>RADIUS服务器负载均衡算法</strong><br>负载均衡算法根据RADIUS认证服务器的权重来分配认证请求报文发往的概率<br>E.g. RADIUS服务器1的权重为80，RADIUS服务器2的权重为20，认证请求报文发往1的概率为80%</p>
</blockquote>
<h3 id="2-5-3-可配置RADIUS-CoA-DM-功能"><a href="#2-5-3-可配置RADIUS-CoA-DM-功能" class="headerlink" title="2.5.3 可配置RADIUS CoA/DM 功能"></a>2.5.3 可配置RADIUS CoA/DM 功能</h3><p>CoA和DM是由==RADIUS服务端主动发起的请求==，需要RADIUS客户端开启此功能才能生效</p>
<blockquote>
<p><strong>Redius CoA</strong><br>CoA（Change of Authorization）是指用户认证成功后，Redius可以通过RADIUS协议来修改在线用户的权限或对其进行重认证</p>
<p><strong>Redius CoA的报文交互流程</strong><br><img src="/2022/07/23/AAA%E6%A6%82%E8%BF%B0/image-20220704165357.png" alt="image6"></p>
<ol>
<li> RADIUS服务器根据业务信息，向设备发送CoA-Request报文，请求更改用户的授权信息。该报文中可以包括ACL规则等授权信息。</li>
<li> 设备收到CoA-Request报文后，与设备上的用户信息匹配来识别用户。如果匹配成功，则更改用户的授权信息；如果匹配失败，则保持用户原有授权信息。</li>
<li>设备回应CoA-ACK/NAK报文。<pre><code>-   如果更改成功，则设备向RADIUS服务器回应CoA-ACK报文。
-   如果更改失败，则设备向RADIUS服务器回应CoA-NAK报文。
</code></pre>
</li>
</ol>
</blockquote>
<blockquote>
<p><strong>Redius DM</strong><br>DM（Disconnect Message）是指用户下线报文，即由RADIUS服务器主动发起的强制用户下线的报文</p>
<p><strong>Redius DM的报文交互流程</strong></p>
<blockquote>
<p><img src="/2022/07/23/AAA%E6%A6%82%E8%BF%B0/image-20220704165757.png" alt="image7"></p>
</blockquote>
<ol>
<li> 管理员在RADIUS服务器上强制用户下线，RADIUS服务器向设备发送DM-Request报文，请求用户下线。</li>
<li> 设备收到DM-Request报文后，与设备上的用户信息匹配来识别用户。如果匹配成功，则通知用户下线；如果匹配失败，则用户保持在线。</li>
<li>设备回应DM-ACK/NAK报文。<pre><code>-   如果用户成功下线，设备给RADIUS服务器回应DM-ACK报文。
-   如果用户未下线，设备给RADIUS服务器回应DM-NAK报文。
</code></pre>
</li>
</ol>
</blockquote>
]]></content>
      <categories>
        <category>Networking</category>
      </categories>
  </entry>
  <entry>
    <title>5G专网概述</title>
    <url>/2022/07/24/5G%E4%B8%93%E7%BD%91%E6%A6%82%E8%BF%B0/</url>
    <content><![CDATA[<h2 id="1-移动网络概述"><a href="#1-移动网络概述" class="headerlink" title="1. 移动网络概述"></a>1. 移动网络概述</h2><p>不管是2G、3G、4G还是5G，移动通信网络主要由两个子系统组成</p>
<ol>
<li> 无线接入网（RAN）</li>
<li> 移动核心网</li>
</ol>
<h3 id="1-1-无线接入网-RAN"><a href="#1-1-无线接入网-RAN" class="headerlink" title="1.1 无线接入网(RAN)"></a>1.1 无线接入网(RAN)</h3><ul>
<li><p>  RAN负责管理无线部分，以高效利用频谱资源，并满足用户的服务质量需求</p>
</li>
<li><p>RAN的关键组件叫基站，不同时代的基站的别名不同</p>
<table>
<thead>
<tr>
<th>移动网络Generation</th>
<th>基站别名</th>
</tr>
</thead>
<tbody><tr>
<td><div style="width: 150pt">2G</div></td>
<td><div style="width: 150pt">BTS</div></td>
</tr>
<tr>
<td>3G</td>
<td>NodeB</td>
</tr>
<tr>
<td>4G</td>
<td>eNB</td>
</tr>
<tr>
<td>5G</td>
<td>gNB</td>
</tr>
</tbody></table>
</li>
</ul>
<h3 id="1-2-移动核心网"><a href="#1-2-移动核心网" class="headerlink" title="1.2 移动核心网"></a>1.2 移动核心网</h3><p>在移动网络的核心网中，可以分成两个网络面：==控制面和用户面==<br><img src="/2022/07/24/5G%E4%B8%93%E7%BD%91%E6%A6%82%E8%BF%B0/image-20220717205649.png" alt="image1"></p>
<table>
<thead>
<tr>
<th>核心网网络面</th>
<th>网络面作用</th>
</tr>
</thead>
<tbody><tr>
<td><div style="width: 150pt">控制面</div></td>
<td><div style="width: 150pt">承载信令或控制消息</div></td>
</tr>
<tr>
<td>用户面(也叫数据面或转发面)</td>
<td>承载数据流量</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>移动核心网的能力</strong></p>
<ol>
<li><p>移动核心网在RAN和Internet之间架起了一道桥梁，为数据和语音服务提供Internet连接</p>
</li>
<li><p> 确保连接的QoS质量要求</p>
</li>
<li><p> 管理用户移动性，以确保服务不中断</p>
</li>
<li><p> 计费</p>
</li>
</ol>
</blockquote>
<blockquote>
<p><strong>终端用户通过移动网络建立会话的过程概述</strong><br>终端上网时，基站会为终端建立无线信道连接。这个过程主要分为控制面连接和用户面连接两个阶段：<br>    1.  首先，基站会在手机和核心网的控制面之间建立“控制面”连接，并在两者之间转发信令消息，这些消息包括手机身份验证、注册、移动性管理等。<br>    2.  然后，基站会在手机和核心网的用户面之间建立“用户面”连接，转发用户数据流量</p>
</blockquote>
<hr>
<h2 id="2-第四代4G-LTE核心网"><a href="#2-第四代4G-LTE核心网" class="headerlink" title="2. 第四代4G-LTE核心网"></a>2. 第四代4G-LTE核心网</h2><h3 id="2-1-4G核心网分类"><a href="#2-1-4G核心网分类" class="headerlink" title="2.1 4G核心网分类"></a>2.1 4G核心网分类</h3><p>4G-LTE核心网被称作 EPC（Evolved Packet Core）<br>EPC可以分成两类：</p>
<ul>
<li>传统的LTE核心网: 仅支持接入LTE基站</li>
<li>升级的LTE核心网(EPC+): 不仅支持接入LTE基站，也可支持接入5G基站</li>
</ul>
<h3 id="2-2-4G核心网架构"><a href="#2-2-4G核心网架构" class="headerlink" title="2.2 4G核心网架构"></a>2.2 4G核心网架构</h3><p><img src="/2022/07/24/5G%E4%B8%93%E7%BD%91%E6%A6%82%E8%BF%B0/image-20220717211223.png" alt="image2"></p>
<p>如图，4G核心网主要由以下网元(Network Function)组成</p>
<blockquote>
<p><strong>控制面</strong>：</p>
<table>
<thead>
<tr>
<th>网元名称</th>
<th>网元功能</th>
</tr>
</thead>
<tbody><tr>
<td><div style="width: 140pt">MME(移动性管理实体)</div></td>
<td><div style="width: 300pt">负责追踪和管理终端在RAN中的移动性</div></td>
</tr>
<tr>
<td>HSS(归属用户服务器)</td>
<td>一个数据库，存储与用户签约相关的信息</td>
</tr>
<tr>
<td>PCRF(策略和计费规则)</td>
<td>负责策略控制决策和流量计费</td>
</tr>
</tbody></table>
</blockquote>
<blockquote>
<p><strong>用户面</strong>：</p>
<table>
<thead>
<tr>
<th>网元名称</th>
<th>网元功能</th>
</tr>
</thead>
<tbody><tr>
<td><div style="width: 140pt"> SGW(服务网关) </div></td>
<td><div style="width: 300pt"> 本质上是IP路由器，主要负责与RAN之间转发IP数据包</div></td>
</tr>
<tr>
<td>PGW(分组网关)</td>
<td>本质上是IP路由器，将核心网连接到外部Internet</td>
</tr>
</tbody></table>
</blockquote>
<hr>
<h2 id="3-第五代5G核心网"><a href="#3-第五代5G核心网" class="headerlink" title="3. 第五代5G核心网"></a>3. 第五代5G核心网</h2><h3 id="3-1-5G核心网概述"><a href="#3-1-5G核心网概述" class="headerlink" title="3.1 5G核心网概述"></a>3.1 5G核心网概述</h3><p>5G核心网被称作NGC（Next Generation Core）。<br>NGC是依据5G标准新建的核心网，仅支持接入5G基站。</p>
<h3 id="3-2-5G核心网架构"><a href="#3-2-5G核心网架构" class="headerlink" title="3.2 5G核心网架构"></a>3.2 5G核心网架构</h3><p><img src="/2022/07/24/5G%E4%B8%93%E7%BD%91%E6%A6%82%E8%BF%B0/image-20220717211748.png" alt="image3"></p>
<p>5G核心网主要由以下网元(Network Function)组成:</p>
<blockquote>
<p><strong>控制面</strong>：</p>
<table>
<thead>
<tr>
<th>网元名称</th>
<th>网元功能</th>
<th>4G核心网对应网元</th>
</tr>
</thead>
<tbody><tr>
<td><div style="width: 160pt"> AMF(接入和移动性管理功能)</div></td>
<td>负责终端的移动性和接入管理，包括接入、连接、移动性管理，以及鉴权、位置服务等</td>
<td><div style="width: 140pt"> 大致对应4G EPC中的MME的功能</div></td>
</tr>
<tr>
<td>UDM(统一数据管理)</td>
<td>管理用户数据，包括用户标识、用户签约数据、鉴权数据等</td>
<td>大致对应4G EPC的HSS的部分功能</td>
</tr>
<tr>
<td>PCF(策略控制功能)</td>
<td>负责策略控制</td>
<td>大致对应4G EPC中的PCRF功能</td>
</tr>
<tr>
<td>AUSF(鉴权服务器功能)</td>
<td>就是鉴权服务器，配合UDM专门负责用户鉴权</td>
<td>/</td>
</tr>
<tr>
<td>NEF(网络开放功能)</td>
<td>通过API接口将，将其他网元的业务能力开放给第三方服务商</td>
<td>/</td>
</tr>
<tr>
<td>NRF(网络功能库)</td>
<td>负责对其他网元进行服务注册登记、状态监测等；并允许每个网元可以发现其它其他网元提供的服务。类似Keystone</td>
<td>/</td>
</tr>
<tr>
<td>NSSF(网络切片选择功能)</td>
<td>管理网络切片相关信息，比如负责为终端选择网络切片</td>
<td>/</td>
</tr>
<tr>
<td>SMF(会话管理功能)</td>
<td>==负责会话管理功能，包括IP地址分配、QoS控制、转发路由控制等==</td>
<td>大致对应MME的部分功能加上S/PGW的部分控制面功能</td>
</tr>
</tbody></table>
</blockquote>
<blockquote>
<p><strong>用户面</strong>：</p>
<table>
<thead>
<tr>
<th>网元名称</th>
<th>网元功能</th>
<th>4G核心网对应网元</th>
</tr>
</thead>
<tbody><tr>
<td><div style="width: 160pt"> UPF(用户面功能)</div></td>
<td>==负责在无线接入网和Internet之间转发流量、报告流量使用情况、QoS策略实施等==</td>
<td><div style="width: 140pt"> 对应4G EPC中的S/PGW的用户面</div></td>
</tr>
</tbody></table>
</blockquote>
<h3 id="3-3-5G核心网架构相比于4G核心网架构的提升"><a href="#3-3-5G核心网架构相比于4G核心网架构的提升" class="headerlink" title="3.3 5G核心网架构相比于4G核心网架构的提升"></a>3.3 5G核心网架构相比于4G核心网架构的提升</h3><ol>
<li> 5G核心网的控制面和用户面彻底分离，这使得用户面UPF可灵活下沉，并与边缘计算（MEC）一起分布式部署于更接近用户侧的边缘，从而可降低网络时延，使能低时延5G应用</li>
<li> 5G核心网采用基于服务的架构（SBA）设计，其通过云原生、无状态的VNF（虚拟化网络功能）和共享的数据层让5G核心网更加弹性、高效和灵活</li>
</ol>
<hr>
<h2 id="4-5G专网"><a href="#4-5G专网" class="headerlink" title="4. 5G专网"></a>4. 5G专网</h2><h3 id="4-1-5G专网的分类"><a href="#4-1-5G专网的分类" class="headerlink" title="4.1 5G专网的分类"></a>4.1 5G专网的分类</h3><p>5G专网分为两大类：</p>
<ol>
<li>  国家提供专用的5G频段，用于行业客户自行来组一套完整的5G网络(接入网和核心网都是完全独立的网络)。由于国家不开放私有化的网络频段，行业客户也没有能力去组建一套完整的5G网络，所以==不讨论==</li>
<li> 运营商通过切片技术，通过UPF分流，将用户的数据直接传送到用户的内网，==默认讨论5G专网是依靠此方法实现的==</li>
</ol>
<h3 id="4-1-5G专网的特性"><a href="#4-1-5G专网的特性" class="headerlink" title="4.1 5G专网的特性"></a>4.1 5G专网的特性</h3><ol>
<li> 终端到基站之间通信使用的是5G网络</li>
<li> 专网的数据是需要UPF设备进行分流的，上行不进入运营商的5G核心网</li>
</ol>
<p>只有同时满足以上两条才可以，否则不能算是专网</p>
<h3 id="4-2-5G专网图解"><a href="#4-2-5G专网图解" class="headerlink" title="4.2 5G专网图解"></a>4.2 5G专网图解</h3><p><img src="/2022/07/24/5G%E4%B8%93%E7%BD%91%E6%A6%82%E8%BF%B0/image-20220717213047.png" alt="image4"></p>
<blockquote>
<ol>
<li>在运营商的5G核心网中的SMF中定制园区专属的分流策略</li>
<li>SMF中的分流策略，下发到园区专属搭建的UPF上</li>
<li>终端上线之后只要接入园区内的eNB，会从SMF拿到一个内网地址</li>
<li>内网流量到达私有UPF之后，可以进行本地的边缘计算(MEC)，然后进入内网，这样的数据传输环节将大大减小(用户面流量不进入运营商5G核心网，也不进入互联网)</li>
</ol>
</blockquote>
]]></content>
      <categories>
        <category>Networking</category>
      </categories>
  </entry>
</search>
